# This file defines the dbt DAGs to be generated by the dbt_dag_factory.py
# Each item in `dbt_dags` will become a separate Airflow DAG.

dbt_dags:
  - name: snapshot
    dag_id: volka_dbt_snapshot_pipeline
    description: "Runs dbt snapshots."
    tags: ["snapshot"]
    schedule: null
    commands:
      # The 'snapshot' command runs all snapshots; no selector is typically needed.
      - command: snapshot
    downstream: staging # Staging models run AFTER the snapshot is complete.
  - name: staging
    dag_id: volka_dbt_staging_pipeline
    description: "Runs and tests dbt models in the staging layer."
    tags: ["staging"]
    schedule: null # This DAG is triggered, not scheduled.
    requires_manual_start: true # <-- Add this flag for manual approval
    commands:
      - command: run
        selector: "path:models/staging"
      - command: test
        selector: "path:models/staging"
    downstream: marts_core # Core marts run after staging models.
  - name: marts_core
    dag_id: volka_dbt_marts_core_pipeline
    description: "Runs and tests dbt models in the marts/core layer."
    tags: ["marts", "core"]
    schedule: null
    commands:
      - command: run
        selector: "path:models/marts/core"
      - command: test
        selector: "path:models/marts/core"
    # This DAG runs after the core marts are built.
    downstream: marts_reporting
  - name: marts_reporting
    dag_id: volka_dbt_marts_reporting_pipeline
    description: "Runs and tests dbt models in the marts/reporting layer."
    tags: ["marts", "reporting"]
    schedule: null
    commands:
      - command: run
        selector: "path:models/marts/reporting"
      - command: test
        selector: "path:models/marts/reporting"
    downstream: null # This is the final dbt DAG in the chain.
